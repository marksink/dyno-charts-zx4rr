<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZX-4RR Dyno App</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  
  <!-- Settings Panel -->
  <div id="settingsPanel" class="settings-panel" onclick="closeSettings(event)">
    <div class="settings-content" onclick="event.stopPropagation()">
      <div class="settings-header">
        <div class="settings-title">Unit Preferences</div>
        <div class="settings-close" onclick="closeSettings()">&times;</div>
      </div>
      
      <div class="settings-group">
        <label for="powerUnit">Power Unit:</label>
        <select id="powerUnit" onchange="updateUnitPreferences()">
          <option value="HP">HP (Horsepower)</option>
          <option value="BHP">BHP (Brake Horsepower)</option>
          <option value="PS">PS (Pferdestärke)</option>
          <option value="kW">kW (Kilowatts)</option>
        </select>
      </div>
      
      <div class="settings-group">
        <label for="torqueUnit">Torque Unit:</label>
        <select id="torqueUnit" onchange="updateUnitPreferences()">
          <option value="lb-ft">lb-ft (pound-feet)</option>
          <option value="Nm">N⋅m (Newton-meters)</option>
          <option value="kgfm">kgf⋅m (kilogram-force meters)</option>
        </select>
      </div>
      
      <div class="settings-group">
        <label for="speedUnit">Speed Unit:</label>
        <select id="speedUnit" onchange="updateUnitPreferences()">
          <option value="MPH">MPH (miles per hour)</option>
          <option value="kmh">km/h (kilometers per hour)</option>
        </select>
      </div>
      
      <div class="settings-buttons">
        <button class="settings-btn secondary" onclick="resetUnitsToDefault()">Reset to Default</button>
        <button class="settings-btn" onclick="closeSettings()">Done</button>
      </div>
    </div>
  </div>

  <div class="controls">
    <div class="control-group">
      <div class="settings-icon" onclick="openSettings()" title="Units Settings">⚙️</div>
    </div>

    <div class="control-group">
      <label for="bikeSelect">Bike:</label>
      <select id="bikeSelect" onchange="changeBike()">
        <option value="">Loading bikes...</option>
      </select>
    </div>

    <div class="control-group">
      <label for="front">F-Sprocket:</label>
      <input id="front" type="number" value="14" step="1" onchange="plotTorque(true)">
    </div>

    <div class="control-group">
      <label for="rear">R-Sprocket:</label>
      <input id="rear" type="number" value="48" step="1" onchange="plotTorque(true)">
    </div>

    <div class="control-group">
      <label for="hpData">ECU Tune:</label>
      <select id="hpData" onchange="plotTorque(true)"></select>
    </div>

    <div class="control-group">
      <label for="viewSelect">Plot:</label>
      <select id="viewSelect" onchange="plotTorque(true)">
        <option value="wheel" selected>Wheel TQ / Shift</option>
        <option value="dyno">Power Curves</option>
        <option value="accel_ts">Time vs Speed</option>
        <option value="accel_td">Time vs Distance</option>
        <option value="accel_tg">Time vs G's</option>
        <option value="accel_sg">Speed vs G's</option>
      </select>
    </div>

    <div class="control-group">
      <label for="shiftRpmSelect">Shift RPM:</label>
      <div class="custom-shift-dropdown">
        <select id="shiftRpmSelect" onchange="handleShiftRpmChange()" style="display: none;">
          <option value="optimal">Optimal</option>
          <option value="custom">Custom</option>
        </select>
        <div class="shift-rpm-display" onclick="toggleShiftRpmDropdown()">
          <span id="shiftRpmDisplayText">Optimal</span>
          <span class="dropdown-arrow">▼</span>
        </div>
        <div id="shiftRpmOptions" class="shift-rpm-options" style="display: none;">
          <div class="shift-option" onclick="selectShiftRpm('optimal')">Optimal</div>
          <div class="shift-option custom-input">
            <input type="number" id="customShiftRpm" placeholder="Enter RPM" min="3400" max="16000" step="100" onkeypress="handleCustomRpmKeypress(event)" onblur="handleCustomRpmBlur()">
          </div>
        </div>
      </div>
    </div>

    <!-- Accel-only controls -->
    <div class="control-group">
      <label id="weightLbLabel" for="weightLb">Weight (lb):</label>
      <input id="weightLb" type="number" value="580" min="300" max="1000" step="1" onchange="plotTorque(true)">
    </div>

    <div class="control-group">
      <label id="shiftMsLabel" for="shiftMs">Shift Time (ms):</label>
      <input id="shiftMs" type="number" value="80" min="0" max="300" step="10" onchange="plotTorque(true)">
    </div>

    <div class="control-group">
      <input type="checkbox" id="truncateCross" onchange="plotTorque(false)">
      <label for="truncateCross">Clip Curves</label>
    </div>
  </div>
  
  <div class="button-row">
    <button onclick="freezeCurrentTraces()">Compare</button>
    <button onclick="clearFrozenTraces()">Reset</button>
  </div>

  <div id="plot" style="position: relative;">
    <div id="freezeNotification" style="
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: rgba(255,255,255,0.9); color: #111; padding: 8px 12px;
        border-radius: 4px; font-weight: bold; display: none; z-index: 1000;">
      Select New Options!
    </div>
  </div>

  <!-- External JavaScript modules -->
  <script src="js/unit-converter.js"></script>
  <script src="js/bike-data.js"></script>
  <script src="js/calculations.js"></script>
  <script src="js/plotting.js"></script>
  <script src="js/ui-controls.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
